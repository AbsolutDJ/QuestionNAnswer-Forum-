<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="index_css.css">

    <title>Forum</title>
</head>

<body>
    <div class="container" id="app">






        <nav class="navbar navbar bg navbar-expand-sm">
            <div class="container">
                <button type="submit" class="btn btn-danger float-right" data-toggle="modal" v-if="!loggedin.username"
                    data-target="#loginModal">Login</button>
                <button type="submit" class="btn btn-danger float-right" data-toggle="modal" v-if="!loggedin.username"
                    data-target="#registerModal">Register</button>
                <button type="submit" class="btn btn-danger float-right" data-toggle="modal" v-if="loggedin.username"
                    data-target="#addQuestionModal">Add Question</button>

                <a href="faq.html"> <button type="submit" class="btn btn-danger float-right">FAQ</button></a>
                <a href="/admin.html" v-if=" loggedin.userlevel == 3 " class="btn btn-info" role="button">ADMIN</a>

                <!-- Logged in user code found at https://codepen.io/cristinaconacel/pen/XymvvO-->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-list-4"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbar-list-4" v-if="loggedin.username">
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img v-bind:src="loggedin.picture" alt="Picture of user" width="40" height="40"
                                    class="rounded-circle">
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">

                                <p> Logged in as: <br> {{ loggedin.username }}

                                </p>
                                <input type="submit" class="dropdown-item" value="Log Out " v-on:click="logout">
                            </div>
                        </li>
                    </ul>
                </div>
        </nav>


        <!-- Login Modal -->
        <div class="modal fade" id="loginModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Login</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formAdd" v-on:submit.prevent>
                            <div class="form-group">
                                <label for="Username">Username</label>
                                <input type="text" class="form-control" name="addUsernamee" id="addUsernamee">
                            </div>
                            <div class="form-group">
                                <label for="Password">Password</label>
                                <input type="password" class="form-control" name="addPassworde" id="addPassworde">
                            </div>


                            <button type="button" class="btn btn-secondary float-right"
                                data-dismiss="modal">Close</button>
                            <input type="submit" class="btn btn-primary float-right" value="Login" v-on:click="doLogin">
                    </div>
                </div>
                </form>
            </div>
        </div>


        <!-- Register Modal -->
        <div class="modal fade" id="registerModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Register for consumers</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formAdd" v-on:submit.prevent>
                            <div class="form-group">
                                <label for="Firstname">Firstname</label>
                                <input type="text" class="form-control" name="addFirstname" id="addFirstname">
                            </div>
                            <div class="form-group">
                                <label for="Lastname">Lastname</label>
                                <input type="text" class="form-control" name="addLastname" id="addLastname">
                            </div>

                            <div class="form-group">
                                <label for="Email">Email</label>
                                <input type="text" class="form-control" name="addEmail" id="addEmail">
                            </div>

                            <div class="form-group">
                                <label for="Username">Username</label>
                                <input type="text" class="form-control" name="addUsername" id="addUsername">
                            </div>

                            <div class="form-group">
                                <label for="Password">Password</label>
                                <input type="text" class="form-control" name="addPassword" id="addPassword">
                            </div>
                            <div class="form-group">
                                <label for="img">Image</label>
                                <input type="file" class="form-control" name="addImg" id="addImg">
                            </div>
                            <button type="button" class="btn btn-secondary float-right"
                                data-dismiss="modal">Close</button>
                            <input type="submit" class="btn btn-primary float-right" value="Register"
                                v-on:click="registerConsumer">
                    </div>
                </div>
                </form>
            </div>
        </div>


        <!-- Add Question Modal -->
        <div class="modal fade" id="addQuestionModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Question</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formAdd" v-on:submit.prevent>
                            <div class="form-group">
                                <label for="QuestionTitle">Question Title</label>
                                <input type="text" class="form-control" name="addQTitle" id="addQTitle">
                            </div>
                            <div class="textarea">
                                <textarea name="addQuestion" id="addQuestion" cols="30" rows="10" width="20px"
                                    placeholder="Whats you question?"></textarea>
                            </div>
                            <label for="addCategory">Choose a topic:</label>

                            <select id="addCategory">
                                <option value="Home">Home</option>
                                <option value="Sports">Sports</option>
                                <option value="Fishing">Fishing</option>
                                <option value="Cars">Cars</option>
                                <option value="School">School</option>
                                <option value="Economics">Economics</option>
                            </select>

                            <button type="button" class="btn btn-secondary float-right"
                                data-dismiss="modal">Close</button>
                            <input type="submit" class="btn btn-primary float-right" value="Add"
                                v-on:click="addQuestion">
                    </div>
                </div>
                </form>
            </div>
        </div>

        <!--Reply Modal-->
        <div class="modal fade" id="replyModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Reply</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formAdd" v-on:submit.prevent>
                            <div class="form-group">
                                <textarea name="addReply" id="addReply" cols="30" rows="10"
                                    placeholder="Reply here..."></textarea>
                            </div>
                            <button type="button" class="btn btn-secondary float-right"
                                data-dismiss="modal">Close</button>
                            <input type="submit" class="btn btn-primary float-right" value="Reply" v-on:click="doReply">
                    </div>
                </div>
                </form>
            </div>
        </div>



        <span class="input-icon input-icon-sm ml-auto w-auto">
            <input type="text" class="form-control form-control-sm bg-gray-200 border-gray-200 shadow-none mb-4 mt-4" placeholder="Search forum"
                 />
        </span>

        <label for="showCategory">Show topic by:</label>
        <select v-on:change="getCategory" id="showCategory" name="showCategory">
            <option id="showAllCategory" name="showAllCategory" v-on:change="getAllCategory" value="?">All</option>
            <option id="showCategory" name="showCategory" v-on:change="getCategory" value="Home">Home</option>
            <option id="showCategory" name="showCategory" v-on:change="getCategory" value="Sports">Sports</option>
            <option id="showCategory" name="showCategory" v-on:change="getCategory" value="Fishing">Fishing</option>
            <option id="showCategory" name="showCategory" v-on:change="getCategory" value="Cars">Cars</option>
            <option id="showCategory" name="showCategory" v-on:change="getCategory" value="School">School</option>
            <option id="showCategory" name="showCategory" v-on:change="getCategory" value="Economics">Economics</option>
        </select>

        <!-- /Inner main header -->

        <!-- Inner main body -->

        <!-- Forum List -->
        <div class="inner-main-body p-2 p-sm-3 collapse forum-content show">
            <div class="card mb-2" v-for="question in questcategory" v-bind:key="questcategory.category">
                <div class="card-body p-2 p-sm-3">
                    <div class="media forum-item">
                        <a href="#" data-toggle="collapse" data-target=".forum-content"><img
                                v-bind:src="question.user.picture" class="mr-3 rounded-circle" width="50"
                                alt="User" /></a>
                        <div class="media-body">
                            <h6><a href="#" data-toggle="collapse" data-target=".forum-content"
                                    v-on:click="questionForm(question.id)" class="text-body">{{question.user.username}}</a></h6>
                            <h5 >
                                {{question.title}}
                            </h5>
                            <p>{{ question.text }}</p>
                            <p class="text-muted"> Created at <span class="text-secondary font-weight-bold">{{
                                    question.created_at }}</span></p>
                        </div>
                        <div class="text-muted small text-center align-self-center">
                            <span class="d-none d-sm-inline-block"><i class="far fa-eye"></i> {{ question.category
                                }}</span>

                        </div>
                    </div>
                </div>
            </div>
        </div>




        <!-- /Forum List -->

        <!-- Forum Detail -->
        <div class="inner-main-body p-2 p-sm-3 collapse forum-content">
            <a href="#" class="btn btn-light btn-sm mb-3 has-icon" data-toggle="collapse"
                data-target=".forum-content"><i class="fa fa-arrow-left mr-2"></i>Back</a>
            <div class="card mb-2" v-for="q in qna" v-bind:key="qna.userid" >
                <div class="card-body">
                    <div class="media forum-item">
                        <a href="javascript:void(0)" class="card-link">
                            <img v-bind:src="qna[0].user.picture" class="rounded-circle" width="50" alt="User" />
                            
                        </a>
                        <div class="media-body ml-3">
                            <a href="javascript:void(0)" class="text-secondary">{{  qna[0].user.username }}</a>
                            <small class="text-muted ml-2">{{ qna[0].created_at }}</small>
                            <h5 class="mt-1">{{ qna[0].title }}</h5>
                            <div class="mt-3 font-size-sm">
                                <p>{{ qna[0].text }}</p>
                                <p hidden id="idanswer">{{ qna[0].id }}</p>
                            </div>
                            <button type="submit" class="btn btn-danger float-right" data-toggle="modal" v-if="loggedin.username"
                                data-target="#replyModal">Reply</button>

                            <button type="submit"
                                v-if="loggedin.userid == qna[0].userid || loggedin.userlevel == 3 "
                                class="btn btn-danger float-right" data-toggle="modal" data-target="#updateModalQ"
                                v-on:click="showQuestionInUpdateForm(qna[0].id)">update</button>

                                <button type="button" class="btn btn-danger float-right" data-toggle="modal" v-if="loggedin.userlevel == 2" v-on:click="doDuplicate(qna[0].id)"
                                >duplicate</button> 
                        </div>
                        
                    </div>
                </div>
             </div>
        
            

            <div class="card mb-2" v-for="qanswer in questionanswer" v-bind:key="questionanswer.userid">
                <div class="card-body">
                    <div class="media forum-item">
                        <a href="javascript:void(0)" class="card-link">
                            <img v-bind:src="qanswer.user.picture" class="rounded-circle" width="50" alt="User" />

                            
                        </a>
                        <div class="media-body ml-3">
                            <a href="javascript:void(0)" class="text-secondary">{{ qanswer.user.username }}</a>
                            <small class="text-muted ml-2">{{ qanswer.created_at }}</small>
                            <div class="mt-3 font-size-sm">
                                <p> {{ qanswer.comment }}</p>
                            </div>
                            

                            <button type="button" class="btn btn-outline-success"
                                v-if="loggedin.userid == qna[0].userid" v-on:click="doUpVote(qanswer.answerid)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-hand-thumbs-up" viewBox="0 0 16 16">
                                    <path
                                        d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2.144 2.144 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a9.84 9.84 0 0 0-.443.05 9.365 9.365 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111L8.864.046zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.238-1.978.243-.7.407-1.768.482-2.85.025-.362.36-.594.667-.518l.262.066c.16.04.258.143.288.255a8.34 8.34 0 0 1-.145 4.725.5.5 0 0 0 .595.644l.003-.001.014-.003.058-.014a8.908 8.908 0 0 1 1.036-.157c.663-.06 1.457-.054 2.11.164.175.058.45.3.57.65.107.308.087.67-.266 1.022l-.353.353.353.354c.043.043.105.141.154.315.048.167.075.37.075.581 0 .212-.027.414-.075.582-.05.174-.111.272-.154.315l-.353.353.353.354c.047.047.109.177.005.488a2.224 2.224 0 0 1-.505.805l-.353.353.353.354c.006.005.041.05.041.17a.866.866 0 0 1-.121.416c-.165.288-.503.56-1.066.56z">
                                    </path>
                                </svg> {{qanswer.anupVote}}
                            </button>


                            <button type="button" class="btn btn-outline-danger"
                                v-if="loggedin.userid == qna[0].userid"
                                v-on:click="doDownVote(qanswer.answerid)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-hand-thumbs-down" viewBox="0 0 16 16">
                                    <path
                                        d="M8.864 15.674c-.956.24-1.843-.484-1.908-1.42-.072-1.05-.23-2.015-.428-2.59-.125-.36-.479-1.012-1.04-1.638-.557-.624-1.282-1.179-2.131-1.41C2.685 8.432 2 7.85 2 7V3c0-.845.682-1.464 1.448-1.546 1.07-.113 1.564-.415 2.068-.723l.048-.029c.272-.166.578-.349.97-.484C6.931.08 7.395 0 8 0h3.5c.937 0 1.599.478 1.934 1.064.164.287.254.607.254.913 0 .152-.023.312-.077.464.201.262.38.577.488.9.11.33.172.762.004 1.15.069.13.12.268.159.403.077.27.113.567.113.856 0 .289-.036.586-.113.856-.035.12-.08.244-.138.363.394.571.418 1.2.234 1.733-.206.592-.682 1.1-1.2 1.272-.847.283-1.803.276-2.516.211a9.877 9.877 0 0 1-.443-.05 9.364 9.364 0 0 1-.062 4.51c-.138.508-.55.848-1.012.964l-.261.065zM11.5 1H8c-.51 0-.863.068-1.14.163-.281.097-.506.229-.776.393l-.04.025c-.555.338-1.198.73-2.49.868-.333.035-.554.29-.554.55V7c0 .255.226.543.62.65 1.095.3 1.977.997 2.614 1.709.635.71 1.064 1.475 1.238 1.977.243.7.407 1.768.482 2.85.025.362.36.595.667.518l.262-.065c.16-.04.258-.144.288-.255a8.34 8.34 0 0 0-.145-4.726.5.5 0 0 1 .595-.643h.003l.014.004.058.013a8.912 8.912 0 0 0 1.036.157c.663.06 1.457.054 2.11-.163.175-.059.45-.301.57-.651.107-.308.087-.67-.266-1.021L12.793 7l.353-.354c.043-.042.105-.14.154-.315.048-.167.075-.37.075-.581 0-.211-.027-.414-.075-.581-.05-.174-.111-.273-.154-.315l-.353-.354.353-.354c.047-.047.109-.176.005-.488a2.224 2.224 0 0 0-.505-.804l-.353-.354.353-.354c.006-.005.041-.05.041-.17a.866.866 0 0 0-.121-.415C12.4 1.272 12.063 1 11.5 1z">
                                    </path>
                                </svg> {{qanswer.andownVote}}
                            </button>

                            <button type="submit"
                                v-if="loggedin.userid == qanswer.userid || loggedin.userlevel == 3 "
                                class="btn btn-danger float-right" data-toggle="modal" data-target="#updateModal"
                                v-on:click="showAnswerInUpdateForm(qanswer.answerid)">update</button>
                           
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Forum Detail -->

        <div class="modal fade" id="updateModalQ">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Update</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formUpdate">
                            <div class="form-group" hidden>
                                <label for="Id">Id</label>
                                <input type="text" class="form-control" name="updateIdQ" id="updateIdQ" readonly>
                            </div>
                            <div class="form-group">
                                <label for="Comment">Title</label>
                                <input type="text" class="form-control" name="updateTitle" id="updateTitle">
                            </div>
                            <div class="form-group">
                                <label for="Comment">Text</label>
                                <textarea type="textarea" class="form-control" name="updateText" id="updateText" cols="30" rows="10" width="20px"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="Category">Category</label>
                                <label for="updateCategory">Choose a topic:</label>

                                <select id="updateCategory">
                                    <option value="Home">Home</option>
                                    <option value="Sports">Sports</option>
                                    <option value="Fishing">Fishing</option>
                                    <option value="Cars">Cars</option>
                                    <option value="School">School</option>
                                    <option value="Economics">Economics</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-danger float-right"
                                    v-on:click="deleteQuestion">Delete</button>
                                <input type="submit" class="btn btn-primary float-right" value="Save changes"
                                    v-on:click="updateQuestion">

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- /Inner main body -->

        <div class="modal fade" id="updateModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Update</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formUpdate">
                            <div class="form-group" hidden>
                                <label for="Id">Id</label>
                                <input type="text" class="form-control" name="updateId" id="updateId" readonly>
                            </div>
                            <div class="form-group">
                                <label for="Comment">Comment</label>
                                <textarea type="text" class="form-control" name="updateComment" id="updateComment" cols="30" rows="10" width="20px"></textarea>
                            </div>
                            <div class="form-group">
                                
                                <button type="submit" class="btn btn-danger float-right"
                                v-on:click="deleteAnswer">Delete</button>

                                <button type="submit" class="btn btn-primary float-right" value="Save changes"
                                    v-on:click="updateAnswer">Update</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- /Inner main -->


        <!-- New Thread Modal -->
        <div class="modal fade" id="threadModal" tabindex="-1" role="dialog" aria-labelledby="threadModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <form>
                        <div class="modal-header d-flex align-items-center bg-primary text-white">
                            <h6 class="modal-title mb-0" id="threadModalLabel">New Discussion</h6>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="threadTitle">Title</label>
                                <input type="text" class="form-control" id="threadTitle" placeholder="Enter title"
                                    autofocus="" />
                            </div>
                            <textarea class="form-control summernote" style="display: none;"></textarea>

                            <div class="custom-file form-control-sm mt-3" style="max-width: 300px;">
                                <input type="file" class="custom-file-input" id="customFile" multiple="" />
                                <label class="custom-file-label" for="customFile">Attachment</label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary">Post</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>





    <script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <script>
        const vm = new Vue({

            el: "#app",
            data: {

                loggedin: {},
                consumers: [],
                questions: [],
                qna: [],
                answers: [],
                user: {},
                questionanswer: [],
                questcategory: [],

                //Declaring message with a empty value
                message: ''

            },

            methods: {

                questionForm(id) {
                    var self = this;
                    $.getJSON("/questionby/" + id, function (jsondata) {
                        //console.log(JSON.stringify(jsondata));
                        self.qna = jsondata;
                        
                      
                    });
                    $.getJSON("/answerby/" + id, function (jsondata) {
                        //console.log(JSON.stringify(jsondata)); 
                        self.questionanswer = jsondata;
                        
                        
                        
                  });

                },

                registerConsumer() {
                    let cons = {
                        email: $('#registerModal #addEmail').val(),
                        firstname: $('#registerModal #addFirstname').val(),
                        lastname: $('#registerModal #addLastname').val(),
                        password: $('#registerModal #addPassword').val(),
                        username: $('#registerModal #addUsername').val(),
                    }


                    $.ajax({
                        url: '/add/consumer',
                        type: 'POST',
                        data: cons,
                        success: (result) => {
                            var self = this;
                            console.log(result)
                            if (result.status == "ok") {
                                var uID = result.user.lastID;


                                let consumer = new FormData();
                                const id = $(cons.id);
                                consumer.append('id', parseInt(uID));
                                consumer.append('file', $('#registerModal #addImg').prop('files')[0]);

                                $.ajax({
                                    url: '/file',
                                    type: 'POST',
                                    data: consumer,
                                    processData: false,
                                    contentType: false,
                                    success: () => {
                                        var self = this;



                                        $.getJSON("/consumers", function (jsondata) {
                                            console.log(JSON.stringify(jsondata));
                                            self.consumers = jsondata;
                                            $('#registerModal').modal('hide');



                                        });
                                    }
                                });
                            }

                        }
                    });

                },

                doLogin() {
                    
                    const prod = {
                        username: $('#loginModal #addUsernamee').val(),
                        password: $('#loginModal #addPassworde').val()
                    }
                   
                    $.ajax({
                        url: '/consumer/' + prod.username,
                        type: 'GET',
                        success: (result) => {
                            blocked = result.isblocked;
                            if(result.isblocked==1){
                                window.alert("You have been blocked")
                                abort();
                            }
                            
                        $.ajax({
                            url: '/user/login',
                            type: 'POST',
                            data: prod,
                            success: (result) => {
                                if (result == true && blocked == 0) {        
                                    var self = this;
                                    this.loggedin = result["user"];
                                    location.reload();  //Reloads the current page.
                                    $('#loginModal').modal('hide');
                                    abort();
                                    
                                }
                                else{
                                    window.alert("Wrong Credentials")
                                }                                                  
                        }
                            });
                        }
                    });

                },
            

                getLoggedIn: function () {


                    $.ajax({
                        url: '/loggedinuser',
                        type: 'GET',
                        success: (data) => {
                            if (data["loggedin"]) {
                                this.loggedin = data["user"]
                            } 
                            else {
                                console.log("No validation done")
                            }
                        },
                            error: (data) => {
                                console.log("Error", data)
                            }
                    });

                },

                logout() {

                    $.ajax({
                        url: '/logout',
                        type: 'GET',
                        success: () => {
                            this.user = {}
                            window.location.href = "/index.html";
                        }
                    });
                },

                addQuestion() {

                    $.ajax({
                        url: '/loggedinuser',
                        type: 'GET',
                        success: (result) => {
                            const a = result.user.userid;
                            
                            const ques = {
                                title: $('#addQuestionModal #addQTitle').val(),
                                text: $('#addQuestionModal #addQuestion').val(),
                                category: $('#addQuestionModal #addCategory').val(),
                                userid: a
                            }
                            $.ajax({
                                url: '/addQuestion/',
                                type: 'POST',
                                data: ques,
                                success: (data) => {
                                    $('#addQuestionModal').modal('hide');
                                    location.reload();

                                }
                            });

                        }
                    })

                },

                doReply() {

                    $.ajax({
                        url: '/loggedinuser',
                        type: 'GET',
                        success: (result) => {
                            const a = result.user.userid;
                            const p = document.getElementById('idanswer').innerHTML;
                            const answ = {
                                comment: $('#replyModal #addReply').val(),
                                questionidforanswer: p,
                                userid: a,

                            }
                            $.ajax({

                                url: '/add/answer',
                                type: 'POST',
                                data: answ,
                                success: (data) => {
                                    console.log("Answer made for question with ID: " + answ.questionidforanswer)
                                    
                                    $('#replyModal').modal('hide');
                                    vm.getoneanswer(answ.questionidforanswer)

                                }
                            });
                        }

                    })

                },

                doUpVote(answerid) {
                    let data = { aid: answerid }
                    
                    $.ajax({
                        url: '/answer/upvote',
                        type: 'put',
                        data: data,
                        success: (result) => {

                            vm.getallanswer(answerid)

                        }
                    });
                },


                getAnswer(id) {
                    let data = { aid: id }

                    $.ajax({
                        url: '/answerby/' + data,
                        type: 'GET',
                        success: (result) => {
                        }
                    });
                },

                doDownVote(answerid) {
                    let data = { aid: answerid }

                    $.ajax({
                        url: '/answer/downvote',
                        type: 'put',
                        data: data,
                        success: (result) => {
                        
                            vm.getallanswer(answerid)


                        }
                    });
                },

               //funktion som hämtar svaren. 
                getallanswer: function (answerid) {
                    $.ajax({
                        url: '/answerstest2/' + answerid,
                        type: 'GET',
                        success: (result) => {
                            let val = result[0].questionidforanswer;
                                $.ajax({
                                    url: '/answerby/' + val,
                                    type: 'GET',
                                    success: (result) => {
                                    this.questionanswer = result;                                  
                                    }
                                });
                        }
                    });
                },

                getoneanswer: function (id) {
                    $.ajax({
                        url: '/answerby/' + id,
                        type: 'GET',
                        success: (result) => {
                            this.questionanswer = result;
                        }
                    });
                },

                showAnswerInUpdateForm(answerid) {
                    $.ajax({
                        url: '/answerbyid/' + answerid,
                        type: 'GET',
                        success: (result) => {
                            $('#updateId').val(result[0].answerid);
                            $('#updateComment').val(result[0].comment);
                        }
                    });
                    $('#updateModal').modal('show');
                },

                updateAnswer() {
                    const answer = {
                        comment: $('#updateModal #updateComment').val(),
                        id: $('#updateModal #updateId').val()
                    }
                        $.ajax({
                            url: '/updatea/' + answer.id,
                            type: 'PUT',
                            data: answer,
                            success: () => {
                                var self = this;
                                $.getJSON("/answers", function (jsondata) {
                                    self.qanswers = jsondata;
                                });
                                $('#updateModal').modal('hide');
                            },
                            error: (error) => {
                                console.log(error);
                            }
                        });
                },

                getAllCategory() {
                    $.ajax({
                        url: '/category',
                        type: 'GET',
                        success: (result) => {
                            console.log(result)
                            this.questcategory = result;
                        }

                    });
                },

                getCategory(category) {
                    var category = {
                        category: $('#showCategory').val()
                    }
                    
                    const cat = category.category;
                    
                        $.ajax({
                            url: '/category/' + cat,
                            type: 'GET',
                            success: (result) => {
                                console.log(result)
                                this.questcategory = result;
                            }
                        });
                },
            
            showQuestionInUpdateForm(id) {
                $.ajax({
                    url: '/questionby/' + id,
                    type: 'GET',
                    success: (question) => {
                        console.log(question)
                        $('#updateIdQ').val(question[0].id);
                        $('#updateTitle').val(question[0].title);
                        $('#updateText').val(question[0].text);
                        $('#updateCategory').val(question[0].category);
                        
                    }
                });
                $('#updateModalQ').modal('show');
            },
            //method to update contributor
            updateQuestion() {
                
                var question = {
                    title: $('#updateModalQ #updateTitle').val(),
                    text: $('#updateModalQ #updateText').val(),
                    id: $('#updateModalQ #updateIdQ').val(),
                    category: $('#updateModalQ #updateCategory').val(),
                }
                $.ajax({
                    url: '/updateq/' + question.id,
                    type: 'PUT',
                    data: question,
                    success: () => {

                        var self = this;
                        $.getJSON("/questions", function (jsondata) {
                            self.question = jsondata;

                        });

                        $('#updateModalQ').modal('hide');
                    },
                    error: (error) => {
                        console.log(error);
                    }
                });
            },

            deleteQuestion() {
                var question = {
                    id: $('#updateModalQ #updateIdQ').val()
                }
                $.ajax({
                    url: '/question/' + question.id,
                    type: 'DELETE',
                    success: () => {
                        var self = this;
                        $.getJSON("/questions", function (jsondata) {
                            // console.log(JSON.stringify(jsondata));
                            self.question = jsondata;


                        });
                    }
                });
            },
        
            
            doDuplicate(answerid) {
                let data = { lid: answerid }
                
                    $.ajax({
                        url: '/duplicate/',
                        type: 'put',
                        data: data,
                        success: () => {
                        }
                    });
                },
        
                deleteAnswer() {
                var answer = {
                    id: $('#updateModal #updateId').val()
                }
                $.ajax({
                    url: '/answer/' + answer.id,
                    type: 'DELETE',
                    success: () => {
                        var self = this;
                        $.getJSON("/answers", function (jsondata) {
                            // console.log(JSON.stringify(jsondata));
                            self.questionanswer = jsondata;
                            

                        });
                    }
                });
            },
        },
        
            mounted() {
                //method to get all products
                var self = this;
                $.getJSON("/questions", function (jsondata) {
                    //console.log(JSON.stringify(jsondata));
                    self.questcategory = jsondata;

                });

                var self = this;
                $.getJSON("/answers", function (jsondata) {
                    //console.log(JSON.stringify(jsondata));
                    self.answers = jsondata;

                });
                /*
                 var self = this;
                 $.getJSON("/answerby/" + questionidforanswer, function (jsondata) {
                     console.log(JSON.stringify(jsondata));
                     self.questionanswer = jsondata;
 
                 });
                 */
            }
        });
        vm.getLoggedIn();
       
    </script>
</body>

</html>